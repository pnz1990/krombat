apiVersion: kro.run/v1alpha1
kind: ResourceGraphDefinition
metadata:
  name: loot-graph
  annotations:
    argocd.argoproj.io/sync-wave: "-1"
spec:
  schema:
    apiVersion: v1alpha1
    kind: Loot
    group: game.k8s.example
    spec:
      dungeonName: string | required=true
      itemType: string | required=true
      rarity: string | default="common"
      stat: integer | default=0
    status:
      itemName: "${lootSecret.metadata.name}"
      description: "${lootSecret.data.description}"

  resources:
    - id: lootSecret
      template:
        apiVersion: v1
        kind: Secret
        metadata:
          name: "${schema.metadata.name}"
          namespace: ${schema.metadata.namespace}
          labels:
            game.k8s.example/dungeon: ${schema.spec.dungeonName}
            game.k8s.example/entity: loot
            game.k8s.example/item-type: ${schema.spec.itemType}
            game.k8s.example/rarity: ${schema.spec.rarity}
        stringData:
          itemType: ${schema.spec.itemType}
          rarity: ${schema.spec.rarity}
          stat: "${string(schema.spec.stat)}"
          description: "${schema.spec.itemType == 'weapon' ? 'A ' + schema.spec.rarity + ' weapon (+' + string(schema.spec.stat) + ' damage, 3 uses)' : schema.spec.itemType == 'armor' ? 'A ' + schema.spec.rarity + ' armor (+' + string(schema.spec.stat) + '% defense)' : schema.spec.itemType == 'shield' ? 'A ' + schema.spec.rarity + ' shield (' + string(schema.spec.stat) + '% block chance)' : schema.spec.itemType == 'hppotion' ? 'A ' + schema.spec.rarity + ' HP potion (restores ' + string(schema.spec.stat) + ' HP)' : 'A ' + schema.spec.rarity + ' mana potion (restores ' + string(schema.spec.stat) + ' mana)'}"
